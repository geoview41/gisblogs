<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Centre de gravité – Mobile</title>

  <!-- Leaflet -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js">
  </script>

  <style>
    :root{
      --bg: rgba(255,255,255,.92);
      --shadow: 0 14px 35px rgba(0,0,0,.18);
      --radius: 18px;
      --text: #0f172a;
      --muted: #475569;
      --accent: #2563eb;
      --accent2: #f59e0b;
    }
    html, body { height: 100%; margin: 0; }
    body { background: #0b1220; }
    #map { height: 100%; width: 100%; }

    .topbar{
      position: absolute;
      top: calc(10px + env(safe-area-inset-top));
      left: 10px;
      right: 10px;
      z-index: 1000;
      display: flex;
      gap: 10px;
      align-items: center;
      pointer-events: none;
    }
    .chip{
      pointer-events: auto;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 999px;
      background: var(--bg);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      color: var(--text);
      font: 700 13px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    .btn{
      pointer-events: auto;
      border: 0;
      border-radius: 999px;
      padding: 10px 14px;
      background: var(--accent);
      color: white;
      box-shadow: var(--shadow);
      font: 800 13px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    .sheet{
      position: absolute;
      left: 10px;
      right: 10px;
      bottom: calc(10px + env(safe-area-inset-bottom));
      z-index: 1000;
      background: var(--bg);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      backdrop-filter: blur(12px);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      overflow: hidden;
    }
    .handle{
      width: 44px;
      height: 5px;
      border-radius: 999px;
      background: rgba(15,23,42,.18);
      margin: 10px auto 4px;
    }
    .sheetHeader{
      padding: 8px 14px 6px;
    }
    .title{ font-weight: 900; font-size: 14px; }
    .coords{ font-size: 12px; color: var(--muted); }

    .grid{
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      padding: 10px 14px 14px;
    }
    .card{
      background: rgba(255,255,255,.75);
      border-radius: 14px;
      padding: 10px;
      border: 1px solid rgba(15,23,42,.08);
    }
    .nameRow{
      display:flex;justify-content:space-between;align-items:center;
      font-weight:800;font-size:13px;
    }
    .small{
      margin-top:4px;
      font-size:11px;
      color:var(--muted);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
    }

    .leaflet-control-zoom { display:none; }
    .leaflet-popup-content-wrapper{ border-radius: 14px; }
  </style>
</head>

<body>
  <div id="map"></div>

  <div class="topbar">
    <div class="chip">⭐ Centre : <span id="centerInline">...</span></div>
    <button class="btn" id="btnFit">Recentrer</button>
  </div>

  <div class="sheet">
    <div class="handle"></div>
    <div class="sheetHeader">
      <div class="title">Points & centre de gravité</div>
      <div class="coords">Déplace un point pour voir le centre bouger</div>
    </div>
    <div class="grid" id="peopleGrid"></div>
  </div>

<script>
const points = [
  { name: "Alex",    lat: 46.2060124, lng: 6.15897   },
  { name: "Carlos",  lat: 46.199526,  lng: 6.174057  },
  { name: "Emile",   lat: 46.1905598, lng: 6.2162526 },
  { name: "Christo", lat: 46.2310242, lng: 7.3546131 }
];

// ----- Carte avec fond moderne -----
const map = L.map("map", { zoomControl:false });

L.tileLayer(
  "https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",
  {
    maxZoom: 20,
    attribution: "&copy; OpenStreetMap & CARTO"
  }
).addTo(map);

// ----- Centre de gravité -----
function computeCenter(pts) {
  let s = {lat:0,lng:0};
  pts.forEach(p => { s.lat+=p.lat; s.lng+=p.lng; });
  return { lat: s.lat/pts.length, lng: s.lng/pts.length };
}

// ----- Icônes -----
function personIcon(letter){
  return L.divIcon({
    className:"",
    html:`<div style="
      width:34px;height:34px;border-radius:999px;
      background:#2563eb;border:2px solid white;
      box-shadow:0 10px 24px rgba(37,99,235,.35);
      display:flex;align-items:center;justify-content:center;
      color:white;font-weight:900;">${letter}</div>`,
    iconSize:[34,34],iconAnchor:[17,34]
  });
}

const centerIcon = L.divIcon({
  className:"",
  html:`<div style="
    width:34px;height:34px;border-radius:999px;
    background:#f59e0b;border:2px solid white;
    box-shadow:0 10px 24px rgba(245,158,11,.35);
    display:flex;align-items:center;justify-content:center;
    color:#111;font-weight:900;">★</div>`,
  iconSize:[34,34],iconAnchor:[17,34]
});

// ----- Marqueurs -----
const markers=[];
points.forEach((p,i)=>{
  const m=L.marker([p.lat,p.lng],{draggable:true,icon:personIcon(p.name[0])})
    .addTo(map)
    .bindPopup(`<b>${p.name}</b><br>${p.lat}, ${p.lng}`);
  m.on("drag",e=>{
    const ll=e.target.getLatLng();
    points[i].lat=ll.lat; points[i].lng=ll.lng;
    updateCenter();
  });
  markers.push(m);
});

// ----- Centre visuel -----
let c=computeCenter(points);
const centerMarker=L.marker([c.lat,c.lng],{icon:centerIcon}).addTo(map);
const centerLines=L.polyline([],{weight:2,opacity:.35}).addTo(map);
const centerCircle=L.circle([c.lat,c.lng],{radius:900,opacity:.3,fillOpacity:.07}).addTo(map);

// ----- UI -----
function renderList(){
  const g=document.getElementById("peopleGrid");
  g.innerHTML="";
  points.forEach(p=>{
    const d=document.createElement("div");
    d.className="card";
    d.innerHTML=`<div class="nameRow">${p.name}</div>
      <div class="small">${p.lat.toFixed(6)}, ${p.lng.toFixed(6)}</div>`;
    g.appendChild(d);
  });
}

function updateCenter(){
  const c=computeCenter(points);
  centerMarker.setLatLng([c.lat,c.lng]);
  centerCircle.setLatLng([c.lat,c.lng]);
  centerLines.setLatLngs(points.map(p=>[[p.lat,p.lng],[c.lat,c.lng]]));
  document.getElementById("centerInline").textContent =
    `${c.lat.toFixed(5)}, ${c.lng.toFixed(5)}`;
  renderList();
}

function fitAll(){
  const c=computeCenter(points);
  const b=L.latLngBounds(points.map(p=>[p.lat,p.lng]));
  b.extend([c.lat,c.lng]);
  map.fitBounds(b.pad(.25));
}

document.getElementById("btnFit").onclick=fitAll;

updateCenter();
fitAll();
</script>
</body>
</html>
